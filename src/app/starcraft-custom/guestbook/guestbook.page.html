<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/" (click)="go_to_back()"></ion-back-button>
    </ion-buttons>
    <ion-title>방명록</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <table class="image-table">
    <tr>
      <td style="text-align: center;" (click)="image_change_to(-1)">
        A
      </td>
      <td style="width: 83%;">
        <img style="width: 100%; height: auto;"
          [src]="root+'assets/data/sc1_custom/'+title+'/Screenshots/'+list[picked]" [alt]='title + "_img"'>
      </td>
      <td style="text-align: center;" (click)="image_change_to(1)">
        D
      </td>
    </tr>
    <tr style="height: 16px;">
      <td></td>
    </tr>
    <tr *ngIf="wsc.client && wsc.client.readyState == wsc.client.OPEN">
      <td></td>
      <!-- 데이터형식: id, name, content, password, is_showing, date-formatted -->
      <td class="form-align">
        <div class="text-padding">
          <div class="form" style="background-color: #333;">
            <table class="image-table">
              <tr>
                <td style="width: 100%;">
                  <table style="margin: 16px auto 16px auto;">
                    <tr>
                      <td>
                        <input style="width: 90%;" type="text" placeholder="닉네임 입력" [(ngModel)]="write_data[1]">
                      </td>
                      <td>
                        <input style="width: 90%;" type="password" placeholder="비밀번호 입력" [(ngModel)]="write_data[3]">
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
            </table>
          </div>
          <div class="form">
            <textarea placeholder="방명록 남기기" style="width: 100%; resize: none;" rows="8"
              [(ngModel)]="write_data[2]"></textarea>
          </div>
          <div>
            <ion-button style="max-width: 560px; width: 100%;" (click)="apply_data()">
              작성
            </ion-button>
          </div>
        </div>
      </td>
    </tr>
    <tr>
    </tr>
    <tr *ngIf="!wsc.client">
      <td></td>
      <td class="form-align">
        <div class="text-padding form" style="border: 2px solid #ddd;">
          <p> 알 수 없는 이유로 서버와의 연결에 실패한 것 같습니다. </p>
          <p> 이게 다 무슨일이여.. </p>
          <!-- <p> 대신 앱을 이용하여 작성할 수 있으니 많은 관심 부탁드려요~ </p> -->
          <!-- <p> 안드로이드 플레이스토어: 앱 준비중 </p> -->
        </div>
      </td>
    </tr>
    <tr *ngIf="wsc.client && wsc.client.readyState != wsc.client.OPEN">
      <td></td>
      <td class="form-align">
        <div class="text-padding form" style="border: 2px solid #ddd;">
          <p> 지금은 서버가 휴가중으로 방명록을 작성할 수 없어요 </p>
          <p> 보통 제가 퇴근한 이후 또는 주말에 놀고 있을 때 등 개인 컴퓨터를 사용할 때 서버가 켜집니다. </p>
          <p> 관심과 발걸음에 감사드리며 오늘도 좋은 하루 보내세요 :) </p>
        </div>
      </td>
    </tr>
    <tr *ngFor="let part of total_history; let i=index">
      <td></td>
      <td class="form-align">
        <div *ngIf="i != isModifyMode">
          <div class="text-padding">
            <div class="form" style="background-color: #333;">
              <table class="image-table">
                <tr>
                  <!-- 데이터형식: id, name, content, password, is_showing, date-formatted -->
                  <td style="width: 100%;">{{part[1]}}</td>
                  <td align="center">
                    <table style="margin: 4px 8px 4px 8px;">
                      <tr>
                        <table *ngIf="part[3] && wsc.client && wsc.client.readyState == wsc.client.OPEN">
                          <tr style="padding-top: 12px;">
                            <td>
                              <ion-button style="width: 52px;" (click)="modify_data(i)" shape="round">
                                수정
                              </ion-button>
                            </td>
                            <td>
                              <ion-button style="width: 52px;" (click)="delete_data(part[0], i)" shape="round">
                                삭제
                              </ion-button>
                            </td>
                          </tr>
                        </table>
                      </tr>
                      <tr>
                        <td align="center" style="padding-top: 4px;">{{part[5]}}</td>
                      </tr>
                    </table>
                  </td>
                </tr>
              </table>
            </div>
            <div class="form">
              <textarea *ngIf="part[4] && part[2]" style="width: 100%; resize: none;" rows="8"
                disabled>{{part[2]}}</textarea>
              <textarea *ngIf="part[4] && !part[2]" style="width: 100%; resize: none;" rows="2"
                disabled>{{part[1]}}, 발자국 남기고 갑니다</textarea>
              <textarea *ngIf="!part[4]" style="width: 100%; resize: none;" rows="2"
                disabled>관리자인 제가 이 게시물을 좀 가려놨습니다.</textarea>
            </div>
          </div>
        </div>
        <div *ngIf="i == isModifyMode">
          <div class="text-padding">
            <div class="form" style="background-color: #333;">
              <table class="image-table">
                <tr>
                  <td style="width: 100%;">
                    <table style="margin: 16px auto 16px auto;">
                      <tr>
                        <td>
                          <input style="width: 90%;" type="text" placeholder="닉네임 입력" [(ngModel)]="rewrite_data[1]">
                        </td>
                        <td>
                          <input style="width: 90%;" type="password" placeholder="비밀번호 입력"
                            [(ngModel)]="rewrite_data[3]">
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
              </table>
            </div>
            <div class="form">
              <textarea placeholder="발자국 남기기" style="width: 100%; resize: none;" rows="8"
                [(ngModel)]="rewrite_data[2]"></textarea>
            </div>
            <div>
              <table style="max-width: 560px; width: 100%; margin: 0 auto 0 auto;">
                <tr>
                  <td>
                    <ion-button style="width: 100%;" (click)="apply_rewrite_data(i)">
                      수정
                    </ion-button>
                  </td>
                  <td>
                    <ion-button style="width: 100%;" (click)="cancel_rewrite()">
                      취소
                    </ion-button>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </td>
    </tr>
  </table>
</ion-content>