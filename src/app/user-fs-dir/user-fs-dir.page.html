<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-title>{{lang.text['Settings']['InAppExplorer']}}</ion-title>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="portal/settings"></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-list *ngIf="InAppBrowser">
    <div *ngIf="CurrentDir != ''">
      <ion-item button>
        <ion-icon slot="start" name="folder"></ion-icon>
        <ion-label>.</ion-label>
        <ion-button *ngIf="!cant_dedicated" style="padding-right: 4px;" (click)="ExportDirectoryRecursive()">
          {{lang.text['UserFsDir']['ExportDir']}}
        </ion-button>
        <ion-button (click)="RemoveDirectoryRecursive()">
          {{lang.text['UserFsDir']['RemoveCurrentDir']}}
        </ion-button>
      </ion-item>
      <ion-item button (click)="MoveToUpDir()">
        <ion-icon slot="start" name="folder"></ion-icon>
        <ion-label>..</ion-label>
      </ion-item>
    </div>
    <div *ngIf="CurrentDir == ''">
      <ion-item button (click)="SelectImportFolder()">
        <ion-icon slot="start" name="arrow-down-circle"></ion-icon>
        <ion-label> {{lang.text['UserFsDir']['ImportFolder']}} </ion-label>
      </ion-item>
      <input hidden type="file" id="folder_sel_id" webkitdirectory (change)="inputImageSelected($event)">
    </div>
    <div *ngFor="let folder of DirList">
      <ion-item *ngIf="CurrentDir == folder.dir" button (click)="SelectFolder(folder)">
        <ion-icon slot="start" name="folder"></ion-icon>
        <ion-label>{{folder.name}}</ion-label>
      </ion-item>
    </div>
    <ion-accordion-group #FileSel>
      <div *ngFor="let file of FileList; index as i">
        <ion-accordion *ngIf="CurrentDir == file.dir" [value]="file.path">
          <ion-item slot="header">
            <ion-icon *ngIf="file.viewer == 'image'" slot="start" name="image"></ion-icon>
            <ion-icon *ngIf="file.viewer == 'audio'" slot="start" name="musical-notes"></ion-icon>
            <ion-icon *ngIf="file.viewer == 'video'" slot="start" name="play-circle"></ion-icon>
            <ion-icon *ngIf="file.viewer == 'text'" slot="start" name="reader"></ion-icon>
            <ion-icon *ngIf="file.viewer == 'godot'" slot="start" name="extension-puzzle"></ion-icon>
            <ion-icon *ngIf="file.viewer == 'disabled'" slot="start" name="document"></ion-icon>
            <ion-label *ngIf="FileSel.value == file.path" text-wrap>{{file.name}}</ion-label>
            <ion-label *ngIf="FileSel.value != file.path">{{file.name}}</ion-label>
            <ion-icon class="ion-accordion-toggle-icon hide_accordion_icon"></ion-icon>
          </ion-item>
          <div slot="content">
            <ion-item button>
              <ion-label>{{lang.text['UserFsDir']['Action']}}</ion-label>
              <ion-button *ngIf="file.viewer != 'disabled' && file.viewer != 'image'" class="ion-text-right"
                (click)="OpenFile(file)">
                {{lang.text['UserFsDir']['Open']}}
              </ion-button>
              <ion-button *ngIf="cant_dedicated" class="ion-text-right" (click)="DownloadFile(file)">
                {{lang.text['UserFsDir']['Download']}}
              </ion-button>
              <ion-button class="ion-text-end" (click)="RemoveFile(file, i)">
                {{lang.text['UserFsDir']['Delete']}}
              </ion-button>
            </ion-item>
            <div *ngIf="file.viewer == 'image'" class="image_front_form" (click)="OpenFile(file)">
              <img class="image_front_view" [src]="file.thumbnail" [alt]="file.name">
            </div>
            <ion-item button>
              <ion-label>{{lang.text['UserFsDir']['CreateAt']}}</ion-label>
              <ion-label class="ion-text-end">{{file.timestamp}}</ion-label>
            </ion-item>
          </div>
        </ion-accordion>
      </div>
    </ion-accordion-group>
  </ion-list>
  <ion-list *ngIf="!InAppBrowser">
    <ion-item button (click)="InAppBrowser = true">
      <ion-icon slot="start" name="folder"></ion-icon>
      <ion-label color="medium">/sdcard/Android/data/org.pjcone.portal/files</ion-label>
    </ion-item>
    <div *ngFor="let folder of ExternalFolder">
      <ion-item *ngIf="folder.isDirectory" button (click)="importFolderMiddleAct(folder)">
        <ion-icon slot="start" name="folder"></ion-icon>
        <ion-label>{{folder.name}}</ion-label>
      </ion-item>
      <ion-item *ngIf="folder.isFile" button disabled>
        <ion-icon slot="start" name="document"></ion-icon>
        <ion-label>{{folder.name}}</ion-label>
      </ion-item>
    </div>
  </ion-list>
</ion-content>