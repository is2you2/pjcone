<!-- SPDX-FileCopyrightText: © 2023 그림또따 <is2you246@gmail.com>
SPDX-License-Identifier: MIT -->

<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-title>{{lang.text['Settings']['groupServer']}}</ion-title>
    <ion-buttons slot="start" (click)="go_back()">
      <ion-back-button defaultHref=""></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div id="GroupServerCanvasDiv" style="position: absolute; width: 100%; height: 100%; display: flex; pointer-events: none;">
  </div>
  <div class="profile_img_form">
    <img [hidden]="!nakama.users.self['img']" id="profile_img" class="profile_img" [src]="nakama.users.self['img']"
      [alt]="lang.text['Profile']['img_alt']">
    <img [hidden]="!tmp_img" id="profile_tmp_img" class="profile_img" [src]="tmp_img"
      [alt]="lang.text['Profile']['img_alt']">
    <div class="fore-gradient" (click)="change_img_from_file()"></div>
    <input hidden type="file" [id]="file_sel_id" accept="image/*" (change)="inputImageSelected($event)">
    <div class="username">{{nakama.users.self['display_name'] || lang.text['Profile']['noname_user']}}</div>
  </div>
  <ion-item>
    <ion-input [label]="lang.text['Profile']['user_display_name']" class="ion-text-right"
      [(ngModel)]="nakama.users.self['display_name']"
      [placeholder]="lang.text['Profile']['name_placeholder']"></ion-input>
  </ion-item>
  <div *ngIf="!nakama.users.self['online']">
    <ion-item-divider>
      <ion-label>{{lang.text['Profile']['login_info']}}</ion-label>
    </ion-item-divider>
    <ion-item>
      <ion-input id="email_input" [label]="lang.text['Profile']['email_address']" class="ion-text-right"
        [(ngModel)]="nakama.users.self['email']" (ionChange)="email_modified()"
        [placeholder]="'test@example.com'"></ion-input>
    </ion-item>
    <ion-item>
      <ion-input [label]="lang.text['Profile']['password']" class="ion-text-right" type="password"
        [(ngModel)]="nakama.users.self['password']" [placeholder]="lang.text['Profile']['at_least']"></ion-input>
    </ion-item>
  </div>
  <ion-item button>
    <ion-toggle #ToggleOnline [(ngModel)]="nakama.users.self['online']" (ionChange)="toggle_online()"
      style="pointer-events: none;">{{lang.text['Profile']['login_toggle']}}</ion-toggle>
  </ion-item>
  <ion-accordion-group #ServersList>
    <ion-accordion value="open">
      <ion-item button slot="header">
        <ion-label>{{lang.text['GroupServer']['JoinedServerList']}}</ion-label>
      </ion-item>
      <div slot="content">
        <ion-item *ngIf="CanAddTestServer" button (click)="add_dev_test_server()">
          <ion-label color="secondary">{{lang.text['GroupServer']['UseDevTestServer']}}</ion-label>
        </ion-item>
        <ion-item *ngFor="let server of servers" button (click)="link_group(server.isOfficial, server.target)">
          <div class="additional_form status_bar_single"
            [style]="'background-color: ' + statusBar.colors[(statusBar.groupServer[server.isOfficial][server.target]) || 'offline']">
          </div>
          <ion-label class="form_margin">
            <h2>{{server.name}}</h2>
            <p *ngIf="server.isOfficial != 'official'">{{server.useSSL ? lang.text['GroupServer']['useSSL'] :
              lang.text['GroupServer']['NotuseSSL']}}</p>
          </ion-label>
          <ion-button *ngIf="server.isOfficial != 'official'" (click)="remove_server(server.isOfficial, server.target)">
            {{statusBar.groupServer[server.isOfficial][server.target] == 'online' ?
            lang.text['GroupServer']['RemoveAccount']
            : lang.text['GroupServer']['RemoveUnofficial']}}
          </ion-button>
        </ion-item>
        <ion-item button (click)="OpenNewServerForm()">
          <ion-label class="ion-text-center">{{lang.text['GroupServer']['RegisterServer']}}</ion-label>
        </ion-item>
      </div>
    </ion-accordion>
  </ion-accordion-group>

  <ion-modal #RegisterNewServer [initialBreakpoint]="isMobilePWA ? .6 : .4" [breakpoints]="[.4, .6]">
    <ng-template>
      <ion-content>
        <ion-item>
          <ion-label class="ion-text-center">{{lang.text['GroupServer']['RegisterServer']}}</ion-label>
        </ion-item>
        <ion-item button [disabled]="add_custom_tog">
          <ion-input [label]="lang.text['GroupServer']['DisplayName']" class="ion-text-right"
            [(ngModel)]="dedicated_info.name"
            [placeholder]="lang.text['GroupServer']['DisplayName_placeholder']"></ion-input>
        </ion-item>
        <ion-item button [disabled]="add_custom_tog">
          <ion-input [label]="lang.text['GroupServer']['Address']" class="ion-text-right"
            [(ngModel)]="dedicated_info.address" placeholder="192.168.0.1"></ion-input>
        </ion-item>
        <ion-item button [disabled]="add_custom_tog">
          <ion-input [label]="lang.text['GroupServer']['Key']" [(ngModel)]="dedicated_info.key" class="ion-text-right"
            placeholder="defaultkey">
          </ion-input>
        </ion-item>
        <ion-item button (click)="add_custom_dedicated()" [disabled]="add_custom_tog">
          <ion-label class="ion-text-center">{{lang.text['GroupServer']['submit']}}</ion-label>
        </ion-item>
      </ion-content>
    </ng-template>
  </ion-modal>
  <div *ngIf="session_uid">
    <ion-item-divider>
      <ion-label>{{lang.text['GroupServer']['SessionUid']}}</ion-label>
    </ion-item-divider>
    <ion-item>
      <ion-label text-wrap color="medium" class="ion-text-center" (click)="copy_id()">{{session_uid}}</ion-label>
    </ion-item>
  </div>
</ion-content>