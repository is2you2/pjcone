<!-- SPDX-FileCopyrightText: © 2023 그림또따 <is2you246@gmail.com>
SPDX-License-Identifier: MIT -->

<ion-header>
  <ion-toolbar>
    <ion-title>{{lang.text['TodoDetail']['Title']}}</ion-title>
    <ion-buttons slot="start" (click)="modalCtrl.dismiss()">
      <ion-back-button defaultHref="main"></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <table id="main_table" style="width: 100%; height: 100%;">
    <tr style="height: 100%;">
      <td style="vertical-align: top;">
        <div id="p5timer" style="position: absolute; width: 100%; height: 8px; z-index: 2;"></div>
        <div id="main_div" class="main">
          <ion-item *ngIf="!isModify" (click)="StoreAtSelClicked()">
            <ion-label>{{lang.text['TodoDetail']['StoreAt']}}</ion-label>
            <ion-select #StoreAt style="pointer-events: none;" (ionChange)="StoreAtSelChanged($event)">
              <ion-select-option value="local">{{lang.text['TodoDetail']['OnThisDevice']}}</ion-select-option>
              <ion-select-option *ngFor="let target of AvailableStorageList;" [value]="target">{{target.name}}
              </ion-select-option>
            </ion-select>
          </ion-item>
          <div *ngIf="isModify">
            <ion-item>
              <ion-label color="medium">{{userInput.display_store}}</ion-label>
              <ion-label color="medium" class="ion-text-right">{{userInput.display_creator}}</ion-label>
            </ion-item>
            <ion-item *ngIf="userInput.remote && userInput.remote.channel_id">
              <ion-label color="medium">{{lang.text['TodoDetail']['ManagerIs']}}</ion-label>
              <ion-label color="medium" class="ion-text-right">{{userInput.display_manager}}</ion-label>
            </ion-item>
            <ion-grid fixed>
              <ion-row>
                <ion-col col-33>
                  <ion-item button color="success" [disabled]="!isModifiable || isButtonClicked" (click)="doneTodo()">
                    <ion-label class="ion-text-center">{{lang.text['TodoDetail']['TodoComplete']}}</ion-label>
                  </ion-item>
                </ion-col>
                <ion-col col-33>
                  <ion-item button color="warning"
                    [disabled]="!isModifiable || !userInput.remote || !userInput.remote.channel_id || isButtonClicked"
                    (click)="moveTodo()">
                    <ion-label class="ion-text-center">{{lang.text['TodoDetail']['TodoMoveTo']}}</ion-label>
                  </ion-item>
                </ion-col>
                <ion-col col-33>
                  <ion-item button color="light" disabled (click)="focusTodo()">
                    <ion-label class="ion-text-center">{{lang.text['TodoDetail']['TodoFocus']}}</ion-label>
                  </ion-item>
                </ion-col>
              </ion-row>
            </ion-grid>
          </div>
          <ion-item>
            <ion-label>{{lang.text['TodoDetail']['DisplayName']}}</ion-label>
            <ion-input [(ngModel)]="userInput.title" class="ion-text-right"
              [placeholder]="lang.text['TodoDetail']['DisplayName_placeholder']"></ion-input>
          </ion-item>
          <ion-item button (click)="ImporantSelClicked()">
            <ion-label>{{lang.text['TodoDetail']['Importance']}}</ion-label>
            <ion-select #ImporantSel style="pointer-events: none;" [value]="userInput.importance"
              (ionChange)="ImporantSelChanged($event)">
              <ion-select-option value="2">{{lang.text['TodoDetail']['Importance_2']}}</ion-select-option>
              <ion-select-option value="1">{{lang.text['TodoDetail']['Importance_1']}}</ion-select-option>
              <ion-select-option value="0">{{lang.text['TodoDetail']['Importance_0']}}</ion-select-option>
            </ion-select>
          </ion-item>
          <ion-item *ngIf="!needInputNewTagName" button (click)="TagSelClicked()">
            <ion-label>{{lang.text['TodoDetail']['Tag']}}</ion-label>
            <ion-select #TagSel style="pointer-events: none;" [value]="userInput.tags" multiple="true"
              [placeholder]="lang.text['TodoDetail']['SelectTag']" (ionChange)="TagSelChanged($event)">
              <ion-select-option value="@new_tag">{{lang.text['TodoDetail']['NewTag']}}</ion-select-option>
              <ion-select-option *ngFor="let tag of saved_tag" [value]="tag">{{tag}}</ion-select-option>
            </ion-select>
          </ion-item>
          <ion-item *ngIf="needInputNewTagName">
            <ion-label>{{lang.text['TodoDetail']['Tag']}}</ion-label>
            <ion-input [(ngModel)]="InputNewTag" type="text" class="ion-text-end"
              [placeholder]="lang.text['TodoDetail']['NewTagName']">
            </ion-input>
            <ion-button style="margin-left: 16px;" (click)="AddNewTag()">
              {{lang.text['TodoDetail']['CreateTag']}}
            </ion-button>
          </ion-item>
          <ion-item button (click)="toggle_start_calendar()">
            <ion-label>{{lang.text['TodoDetail']['startFrom']}}</ion-label>
            <ion-label class="ion-text-right uneditable_data">{{startDisplay ||
              lang.text['TodoDetail']['startImmediatly']}}</ion-label>
          </ion-item>
          <ion-datetime #StartCalendar [hidden]="isStartCalendarHidden" style="display: inline;" [locale]="lang.lang"
            (ionChange)="start_change($event)"></ion-datetime>
          <ion-item button (click)="toggle_calendar()">
            <ion-label>{{lang.text['TodoDetail']['limit']}}</ion-label>
            <ion-label class="ion-text-right uneditable_data">{{limitDisplay}}</ion-label>
          </ion-item>
          <ion-datetime #Calendar [hidden]="isCalendarHidden" style="display: inline;" [locale]="lang.lang"
            (ionChange)="limit_change($event)"></ion-datetime>
          <textarea class="infobox" [(ngModel)]="userInput.description"
            [placeholder]="lang.text['TodoDetail']['description']"></textarea>
          <ion-item>
            <ion-label>{{lang.text['TodoDetail']['attachments']}}</ion-label>
            <ion-button class="ion-text-right" (click)="new_attach()">
              {{lang.text['TodoDetail']['new_attach']}}
            </ion-button>
            <ion-button class="ion-text-right" (click)="select_attach()">
              {{lang.text['TodoDetail']['add_attach']}}
            </ion-button>
          </ion-item>
          <div *ngFor="let attach of userInput.attach; index as i">
            <ion-item>
              <ion-label>{{attach.filename}}</ion-label>
              <ion-button (click)="remove_attach(i)">
                {{lang.text['TodoDetail']['delete_attach']}}
              </ion-button>
            </ion-item>
            <div *ngIf="attach['viewer']">
              <img *ngIf="attach['viewer'] == 'image' && attach['img']" class="image_thumbnail" [src]="attach['img']"
                [alt]="attach['filename']" (click)="open_ionic_viewer(i)">
              <div *ngIf="attach['viewer'] != 'disabled'">
                <ion-item button *ngIf="attach['viewer'] == 'godot'" (click)="open_godot_viewer(i)">
                  <ion-label color="medium">{{lang.text['TodoDetail']['open_content_viewer']}}</ion-label>
                </ion-item>
                <ion-item button *ngIf="attach['viewer'] != 'image' && attach['viewer'] != 'godot'"
                  (click)="open_ionic_viewer(i)">
                  <ion-label color="medium">{{lang.text['TodoDetail']['open_content_viewer']}}</ion-label>
                </ion-item>
              </div>
            </div>
          </div>
          <input hidden type="file" id="file_sel" accept="*" (change)="inputImageSelected($event)">
          <div *ngIf="isModify">
            <ion-item button (click)="toggle_logs()">
              <ion-label>{{lang.text['TodoDetail']['logs']}}</ion-label>
            </ion-item>
            <div [hidden]="isLogsHidden">
              <div *ngFor="let log of userInput.logs" class="logs">
                {{log.displayText}}
              </div>
            </div>
            <div id="content"></div>
          </div>
        </div>
      </td>
    </tr>
    <tr>
      <td>
        <div style="width: 100%;">
          <table id="bottom_buttons" style="width: 100%; background-color: black;">
            <tr>
              <td>
                <ion-button [disabled]="!isModifiable || isButtonClicked" (click)="saveData()" expand="block">
                  {{buttonDisplay.saveTodo}}
                </ion-button>
              </td>
              <td *ngIf="isModify">
                <ion-button color="danger" [disabled]="!isModifiable || isButtonClicked" (click)="deleteData()"
                  expand="block">
                  {{lang.text['TodoDetail']['remove']}}
                </ion-button>
              </td>
            </tr>
          </table>
        </div>
      </td>
    </tr>
  </table>
</ion-content>